<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitar Viagem</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>

    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>UnexViagem</h2>
        </div>
        <ul class="sidebar-nav">
            <li><a href="index.html">üí∞ UnexViagem</a></li>
            <li><a href="dashboard.html">üìä Dashboard</a></li>
            <li><a href="minhas-viagens.html">‚úàÔ∏è Minhas Viagens</a></li>
            <li><a href="solicitar.html" class="active">üìù Solicitar Viagem</a></li>
            <li><a href="relatorios.html">üí∞ Relat√≥rios</a></li>
            <li><a href="configuracoes.html">‚öôÔ∏è Configura√ß√µes</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <header>
            <h1>Solicitar Viagem</h1>
        </header>

        <section class="form-container">
            <div class="form-header">
                <h2>Nova Solicita√ß√£o de Viagem</h2>
            </div>

            <form id="solicitar-form" action="#" method="POST">
                <div class="form-grid">

                    <div class="form-group">
                        <label for="destino">Destino (Cidade, Estado/Pa√≠s)</label>
                        <input type="text" id="destino" name="destino" placeholder="Ex: S√£o Paulo, SP" required>
                    </div>

                    <div class="form-group">
                        <label for="data-inicio">Data de In√≠cio</label>
                        <input type="date" id="data-inicio" name="data-inicio" required>
                    </div>

                    <div class="form-group">
                        <label for="data-fim">Data de Fim</label>
                        <input type="date" id="data-fim" name="data-fim" required>
                    </div>

                    <div class="form-group">
                        <label for="custo-estimado">Custo Estimado (R$)</label>
                        <input type="number" id="custo-estimado" name="custo-estimado" placeholder="Ex: 1500.00" step="0.01" min="0" required>
                    </div>

                    <div class="form-group full-width">
                        <label for="motivo">Motivo da Viagem</label>
                        <textarea id="motivo" name="motivo" placeholder="Descreva o objetivo principal da viagem..." required></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="observacoes">Observa√ß√µes (Opcional)</label>
                        <textarea id="observacoes" name="observacoes" placeholder="Informa√ß√µes adicionais..."></textarea>
                    </div>

                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='dashboard.html'">Cancelar</button>
                    <button type="submit" class="btn btn-success">Enviar Solicita√ß√£o</button>
                </div>
            </form>
        </section>
    </main>

    <script>
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'index.html';
        }

        document.getElementById('solicitar-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const destino = document.getElementById('destino').value;
            const dataInicio = document.getElementById('data-inicio').value;
            const dataFim = document.getElementById('data-fim').value;
            const custoEstimado = parseFloat(document.getElementById('custo-estimado').value);
            const motivo = document.getElementById('motivo').value;
            const observacoes = document.getElementById('observacoes').value;

            if (new Date(dataInicio) >= new Date(dataFim)) {
                alert('Data de in√≠cio deve ser antes da de fim.');
                return;
            }

            try {
                const response = await fetch('http://localhost:4000/api/travel-requests', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        destino,
                        data_inicio: dataInicio,
                        data_fim: dataFim,
                        custo_estimado: custoEstimado,
                        motivo,
                        observacoes,
                        status: 'pendente'
                    })
                });

                if (response.ok) {
                    alert('Solicita√ß√£o enviada com sucesso! Ela aparecer√° como pendente no Dashboard.');
                    window.location.href = 'dashboard.html';
                } else {
                    const error = await response.json();
                    alert('Erro ao enviar solicita√ß√£o: ' + (error.error || 'Erro desconhecido'));
                }
            } catch (err) {
                alert('Erro de conex√£o: ' + err.message);
            }
        });
    </script>
</body>

</html>